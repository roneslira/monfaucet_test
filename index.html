<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monad Testnet MON Faucet</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            background: linear-gradient(to bottom, #000000, #2A343C);
            color: #FFFFFF;
            min-height: 100vh;
            text-align: center;
            overflow-x: hidden;
        }
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 50;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a img { width: 200px; }
        nav button {
            background: #374221;
            color: #BBF531;
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            transition: all 0.5s ease-in-out, transform 0.2s;
        }
        nav button:hover {
            transform: scale(1.05);
            background: rgba(163, 230, 53, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        nav button:active { transform: scale(0.95); }
        .main-content {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .faucet-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 28rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            margin-top: 5rem;
        }
        .faucet-container h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: #DDD;
            margin-bottom: 0.5rem;
        }
        .faucet-container p { color: #A9B7C0; margin-bottom: 2rem; }
        .task-button {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.75rem;
            color: #EEE;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .task-button:hover { background: rgba(0, 0, 0, 0.4); }
        .task-button .icon { font-size: 1.25rem; }
        .task-button .arrow { color: #A9B7C0; }
        .info-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .info-box div { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .info-box span { color: #A9B7C0; }
        .info-box a { color: #EEE; text-decoration: none; }
        .complete-button {
            width: 100%;
            background: linear-gradient(to right, #C2FF2C, #89B31B);
            color: #000;
            font-weight: bold;
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .complete-button:hover { transform: scale(1.02); }
        .complete-button:active { transform: scale(0.98); }
        .tasks-completed { color: #A9B7C0; font-size: 0.875rem; margin-top: 1rem; }
        .decorative-blur {
            position: absolute;
            border-radius: 50%;
            filter: blur(3rem);
            pointer-events: none;
        }
        .blur-1 { top: 25%; left: 25%; width: 16rem; height: 16rem; background: rgba(194, 255, 44, 0.2); }
        .blur-2 { bottom: 33%; right: 33%; width: 24rem; height: 24rem; background: rgba(128, 0, 128, 0.1); }
    </style>
</head>
<body>
    <nav>
        <a href="/"><img src="logo/newlogo_cult.png" alt="CULT.TRADE Logo" width="200"></a>
        <div>
            <button>Connect Wallet</button>
            <button>üö∞ Faucet</button>
        </div>
    </nav>
    <canvas class="fixed top-0 left-0 w-full h-full"></canvas>
    <div class="main-content">
        <div class="faucet-container">
            <h1>Monad Testnet Faucet</h1>
            <p>Complete tasks to get tokens</p>
            <div class="task-buttons">
                <button class="task-button">
                    <div class="flex items-center gap-3">
                        <span class="icon">üîó</span>
                        <span>Connect your wallet</span>
                    </div>
                    <span class="arrow">‚Üí</span>
                </button>
                <button class="task-button">
                    <div class="flex items-center gap-3">
                        <span class="icon">ùïè</span>
                        <span>Follow us on X.com</span>
                    </div>
                    <span class="arrow">‚Üí</span>
                </button>
                <button class="task-button">
                    <div class="flex items-center gap-3">
                        <span class="icon">üëç</span>
                        <span>Like our post on ùïè</span>
                    </div>
                    <span class="arrow">‚Üí</span>
                </button>
                <button class="task-button">
                    <div class="flex items-center gap-3">
                        <span class="icon">ùïã</span>
                        <span>Join cult on Telegram</span>
                    </div>
                    <span class="arrow">‚Üí</span>
                </button>
            </div>
            <div class="info-box">
                <div><span>Available:</span><span>0.00 MON</span></div>
                <div><span>Network:</span><span>Monad Testnet</span></div>
                <div>
                    <span>Contract:</span>
                    <span class="flex items-center">
                        <a href="https://testnet.monadexplorer.com/address/0x4050feb951B8d87C030959766f636BF93f5Ebca2" target="_blank" rel="noopener noreferrer">
                            0x4050...bca2
                        </a>
                    </span>
                </div>
            </div>
            <button class="complete-button" disabled>Complete All Tasks</button>
            <div class="tasks-completed">0 of 4 tasks completed</div>
        </div>
        <div class="decorative-blur blur-1"></div>
        <div class="decorative-blur blur-2"></div>
    </div>
    <script>
        // Placeholder para interatividade b√°sica (ser√° expandido no backend)
        const taskButtons = document.querySelectorAll('.task-button');
        let tasksCompleted = 0;

        taskButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.disabled = true;
                button.style.opacity = '0.5';
                tasksCompleted++;
                updateTasksCompleted();
                checkCompleteButton();
            });
        });

        function updateTasksCompleted() {
            document.querySelector('.tasks-completed').textContent = `${tasksCompleted} of 4 tasks completed`;
        }

        function checkCompleteButton() {
            const completeButton = document.querySelector('.complete-button');
            if (tasksCompleted === 4) {
                completeButton.disabled = false;
                completeButton.style.opacity = '1';
                completeButton.style.cursor = 'pointer';
                completeButton.addEventListener('click', () => {
                    alert('Tokens MON enviados! (Simula√ß√£o)');
                });
            }
        }
    </script>
    const express = require('express');
    const ethers = require('ethers');
    const axios = require('axios'); // Para verificar tarefas sociais (ex.: Twitter, Telegram)
    const app = express();
    
    app.use(express.json());
    app.use(express.static('public')); // Servir os arquivos HTML/CSS da Parte 1
    
    // Configurar o provedor RPC da Monad Testnet
    const provider = new ethers.providers.JsonRpcProvider('https://testnet-rpc.monad.xyz/');
    const privateKey = 'SEU_PRIVATE_KEY_AQUI'; // Substitua por uma chave privada segura para a carteira faucet
    const wallet = new ethers.Wallet(privateKey, provider);
    
    // Endere√ßo da carteira com tokens MON de teste
    const faucetAddress = '0x...'; // Substitua pelo endere√ßo da carteira que possui tokens MON (ex.: 0x4050feb951B8d87C030959766f636BF93f5Ebca2)
    
    // Configura√ß√µes da faucet
    const TOKENS_PER_REQUEST = ethers.utils.parseEther('0.05'); // 0.05 MON por solicita√ß√£o
    const DAILY_LIMIT = 1; // Limite de 1 solicita√ß√£o por endere√ßo por dia
    const TASKS_REQUIRED = 4; // N√∫mero de tarefas para desbloquear tokens
    
    // Armazenamento simples em mem√≥ria (substitua por um banco de dados em produ√ß√£o, como MongoDB ou Redis)
    let requestHistory = new Map(); // { endere√ßo: { lastRequest: timestamp, requestsToday: count } }
    
    // Fun√ß√£o para verificar o limite di√°rio
    function checkDailyLimit(address) {
        const now = Date.now();
        const record = requestHistory.get(address) || { lastRequest: 0, requestsToday: 0 };
        
        // Reinicia o contador se passou mais de 24 horas desde a √∫ltima solicita√ß√£o
        if (now - record.lastRequest > 24 * 60 * 60 * 1000) {
            record.lastRequest = now;
            record.requestsToday = 0;
        }
    
        if (record.requestsToday >= DAILY_LIMIT) {
            return false;
        }
        return true;
    }
    
    // Fun√ß√£o para verificar tarefas sociais (simplificada; ajuste para APIs reais de Twitter/Telegram)
    async function verifyTasks(address, tasks) {
        // Exemplo simulado: verifica se todas as tarefas foram marcadas como completas
        if (tasks.length !== TASKS_REQUIRED) {
            return { success: false, message: 'Complete todas as 4 tarefas.' };
        }
    
        // Simula√ß√£o de verifica√ß√£o (substitua por APIs reais, como Twitter API v2 ou Telegram Bot API)
        for (const task of tasks) {
            if (!task.completed) {
                return { success: false, message: `Tarefa pendente: ${task.name}` };
            }
        }
    
        // Verificar se o endere√ßo est√° conectado √† Monad Testnet (simplificado)
        try {
            const balance = await provider.getBalance(address);
            if (balance.eq(0)) {
                return { success: false, message: 'Conecte sua carteira √† Monad Testnet.' };
            }
        } catch (error) {
            return { success: false, message: 'Endere√ßo de carteira inv√°lido.' };
        }
    
        return { success: true, message: 'Tarefas verificadas com sucesso!' };
    }
    
    // Rota para distribuir tokens
    app.post('/api/faucet', async (req, res) => {
        const { address, tasks } = req.body; // tasks √© um array com { name: 'taskName', completed: true/false }
    
        // Verificar endere√ßo e limite di√°rio
        if (!ethers.utils.isAddress(address)) {
            return res.json({ success: false, message: 'Endere√ßo de carteira inv√°lido.' });
        }
    
        if (!checkDailyLimit(address)) {
            return res.json({ success: false, message: 'Limite di√°rio atingido. Tente novamente em 24 horas.' });
        }
    
        // Verificar tarefas sociais
        const taskResult = await verifyTasks(address, tasks);
        if (!taskResult.success) {
            return res.json(taskResult);
        }
    
        try {
            // Enviar tokens MON para o endere√ßo
            const tx = await wallet.sendTransaction({
                to: address,
                value: TOKENS_PER_REQUEST
            });
    
            await tx.wait();
    
            // Atualizar hist√≥rico de solicita√ß√µes
            const record = requestHistory.get(address) || { lastRequest: Date.now(), requestsToday: 0 };
            record.requestsToday++;
            requestHistory.set(address, record);
    
            res.json({ 
                success: true, 
                message: 'Tokens MON enviados com sucesso! 0.05 MON para ' + address,
                txHash: tx.hash 
            });
        } catch (error) {
            res.json({ success: false, message: 'Erro ao enviar tokens: ' + error.message });
        }
    });
    
    // Rota para verificar status (opcional, para atualizar a UI)
    app.get('/api/status', (req, res) => {
        const address = req.query.address;
        if (!address || !ethers.utils.isAddress(address)) {
            return res.json({ available: '0.00 MON', network: 'Monad Testnet', contract: '0x4050...bca2' });
        }
    
        res.json({ 
            available: '0.00 MON', // Atualize com l√≥gica real para saldo dispon√≠vel
            network: 'Monad Testnet',
            contract: '0x4050feb951B8d87C030959766f636BF93f5Ebca2'
        });
    });
    
    const PORT = process.env.PORT || 3000;
    app.listen(PORT, () => console.log(`Faucet rodando na porta ${PORT}`));
    
